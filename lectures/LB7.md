
## Урок 6 SQL: Многостоловые запросы с объединениями

До сих пор мы работали с одной таблицей, но данные объектов в реальном мире часто разбиваются на части и хранятся в нескольких связанных таблицах с использованием процесса, известного как  _нормализация_[[1]](http://en.wikipedia.org/wiki/Database_normalization "Нормализация базы данных").

### Нормализация базы данных

Нормализация базы данных полезна, поскольку она сводит к минимуму дублирование данных в любой отдельной таблице и позволяет данным в базе данных расти независимо друг от друга (например.  Типы автомобильных двигателей могут расти независимо от каждого типа автомобиля).  В качестве компромисса запросы становятся немного сложнее, поскольку они должны иметь возможность находить данные из разных частей базы данных, а при работе со многими большими таблицами могут возникать проблемы с производительностью.

Чтобы ответить на вопросы о сущности, данные которой охватывают несколько таблиц в нормализованной базе данных, нам нужно научиться писать запрос, который может объединить все эти данные и получить именно ту информацию, которая нам нужна.

### Запросы к нескольким таблицам с помощью JOIN

Таблицы, которые совместно используют информацию об одной сущности, должны иметь  _первичный ключ_, который  _однозначно_  идентифицирует эту сущность во всей базе данных.  Одним из распространенных типов первичного ключа является автоинкрементное целое число (поскольку они экономят место), но это также может быть строка, хэшированное значение, если оно уникально.

Используя  `JOIN`  предложение в запросе, мы можем объединить данные строк в двух отдельных таблицах, используя этот уникальный ключ.  Первое из объединений, которое мы представим, - это  `INNER JOIN`.

Выберите запрос с `INNER JOIN` для нескольких таблиц

```sql
SELECT column, another_table_column, …
FROM mytable
INNER JOIN another_table
	ON mytable.id = another_table.id
WHERE _condition(s)_
ORDER BY column, … ASC/DESC
LIMIT num_limit OFFSET num_offset;
```

`INNER JOIN`  Это процесс, который сопоставляет строки из первой и второй таблиц, которые имеют один и тот же ключ (как определено  `ON`  ограничением), для создания результирующей строки с объединенными столбцами из обеих таблиц.  После объединения таблиц применяются другие предложения, которые мы изучили ранее.

> Знаете ли вы?
> Вы можете видеть запросы, в которых  `INNER JOIN`  записывается просто как  `JOIN`.  Эти два метода эквивалентны, но мы продолжим называть эти объединения внутренними, потому что они облегчают чтение запроса, когда вы начнете использовать другие типы объединений, которые будут представлены в следующем уроке.

#### Упражнение

Мы добавили новую таблицу в базу данных Pixar, чтобы вы могли попробовать попрактиковаться в некоторых соединениях.  В таблице  **BoxOffice**  хранится информация о рейтингах и продажах каждого конкретного фильма Pixar, и столбец  _Movie_id_  в этой таблице соответствует столбцу  _Id_  в таблице 1 к 1 для  **фильмов**.  Попробуйте решить приведенные ниже задачи, используя  `INNER JOIN`  представленный выше.

#### Задачи

1.  Найдите внутренние и международные продажи для каждого фильма
2.  Покажите цифры продаж для каждого фильма, который имел лучший международный успех, чем внутри страны
3.  Перечислите все фильмы по их рейтингам в порядке убывания
